# ======================================================
# CONFIGURAÇÕES GERAIS DA APLICAÇÃO
# ======================================================
quarkus.application.name=DurvalCRM API
quarkus.application.version=1.0.0-SNAPSHOT

# ======================================================
# CONFIGURAÇÃO DE LOGGING
# ======================================================
quarkus.log.level=INFO
quarkus.log.category."br.org.cecairbar.durvalcrm".level=DEBUG
quarkus.log.console.json=false

# ======================================================
# CONFIGURAÇÃO DE VALIDAÇÃO
# ======================================================
quarkus.hibernate-validator.method-validation.allow-parameter-constraints=true

# ======================================================
# PERFIL DE DESENVOLVIMENTO (%dev)
# ======================================================
# %dev - Configuração de Porta HTTP
%dev.quarkus.http.port=8082

# %dev - Banco de dados PostgreSQL
%dev.quarkus.datasource.db-kind=postgresql
%dev.quarkus.datasource.username=durvalcrm_user
%dev.quarkus.datasource.password=durvaldev@123
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/durvalcrm_dev

# %dev - Hibernate ORM
%dev.quarkus.hibernate-orm.database.generation=validate
%dev.quarkus.hibernate-orm.log.sql=true

# %dev - Segurança OIDC (Keycloak)
%dev.quarkus.oidc.enabled=true
%dev.quarkus.oidc.auth-server-url=http://localhost:8080/realms/durval-crm
%dev.quarkus.oidc.client-id=durvalcrm-app
%dev.quarkus.oidc.token.issuer=http://localhost:8080/realms/durval-crm
%dev.quarkus.http.auth.proactive=false

# %dev - Permissões de Acesso
# Por padrão, tudo requer autenticação
%dev.quarkus.http.auth.permission.default.policy=authenticated
# Caminhos públicos são exceções
%dev.quarkus.http.auth.permission.public.paths=/auth/login-info, /q/*, /health/*
%dev.quarkus.http.auth.permission.public.policy=permit

# %dev - CORS - Configuração mais permissiva para desenvolvimento
%dev.quarkus.http.cors=true
%dev.quarkus.http.cors.origins=http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000
%dev.quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with,cache-control,pragma,expires
%dev.quarkus.http.cors.methods=GET,PUT,POST,DELETE,OPTIONS,HEAD,PATCH
%dev.quarkus.http.cors.access-control-allow-credentials=true
%dev.quarkus.http.cors.access-control-max-age=86400

# %dev - Configuração adicional para evitar problemas com preflight
%dev.quarkus.http.cors.exposed-headers=*
%dev.quarkus.http.cors.access-control-expose-headers=*

# ======================================================
# PERFIL DE PRODUÇÃO (%prod)
# ======================================================

# %prod - Configurações de Banco de Dados (usar variáveis de ambiente)
%prod.quarkus.datasource.db-kind=postgresql
%prod.quarkus.datasource.username=${DB_USER}
%prod.quarkus.datasource.password=${DB_PASSWORD}
%prod.quarkus.datasource.jdbc.url=${DB_URL}
%prod.quarkus.hibernate-orm.database.generation=validate
%prod.quarkus.hibernate-orm.log.sql=false

# %prod - Configurações OIDC (usar variáveis de ambiente)
%prod.quarkus.oidc.auth-server-url=${KEYCLOAK_URL}/realms/durval-crm
%prod.quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID}
%prod.quarkus.http.auth.permission.default.policy=authenticated
%prod.quarkus.http.auth.permission.public.paths=/auth/login-info, /q/*, /health/*
%prod.quarkus.http.auth.permission.public.policy=permit

# ======================================================
# PERFIL DE TESTE (%test)
# ======================================================

# %test - Usar banco de dados H2 em memória
%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1

# %test - Recriar o schema a cada execução de teste
%test.quarkus.hibernate-orm.database.generation=drop-and-create
%test.quarkus.hibernate-orm.log.sql=false

# %test - Desabilitar OIDC e permitir todas as requisições HTTP
%test.quarkus.oidc.enabled=false
%test.quarkus.http.auth.permission.default.policy=permit
%test.quarkus.http.auth.proactive=false

# %test - Usar porta diferente para evitar conflitos
%test.quarkus.http.port=8081
# %test - Reduzir ruído de log
%test.quarkus.log.level=WARN
%test.quarkus.log.category."br.org.cecairbar.durvalcrm".level=INFO